import{s as x}from"./SimpleHeader-d42a7f83.js";import{D as O,R as L,x as u,U as P,E as S,I as B,P as T,y as A}from"./index-cb802f07.js";import{g as D,a as E}from"./address-4a88397d.js";import{c as J,p as R}from"./order-9670cc92.js";import{at as V,u as $,ay as q,r as F,ae as U,T as j,o as m,e as h,a as c,ax as s,aE as o,F as H,aw as M,f as z,av as _,aC as I,aA as G,aB as K}from"./_plugin-vue_export-helper-cae794e0.js";import{B as Q}from"./index-968a7cf8.js";import"./use-route-7443569a.js";const W=i=>(G("data-v-4f75e7fd"),i=i(),K(),i),X={class:"create-order"},Y={class:"address-wrap"},Z={class:"address"},ss={class:"good"},as={class:"good-img"},es=["src"],ts={class:"good-desc"},os={class:"good-title"},rs={class:"good-btn"},ds={class:"price"},cs={class:"pay-wrap"},ns={class:"price"},is=W(()=>s("span",null,"商品金额",-1)),ls={style:{width:"90%",margin:"0 auto",padding:"50px 0"}},ps={__name:"CreateOrder",setup(i){const l=$(),g=q(),a=F({cartList:[],address:{},showPay:!1,orderNo:"",cartItemIds:[]});U(()=>{y()});const y=async()=>{O({message:"加载中...",forbidClick:!0});const{addressId:t,cartItemIds:e}=g.query,d=JSON.parse(e||L("cartItemIds"));u("cartItemIds",JSON.stringify(d));const{data:n}=await P({cartItemIds:d.join(",")}),{data:p}=t?await D(t):await E();if(!p){l.push({path:"/address"});return}a.cartList=n,a.address=p,S()},v=()=>{l.push({path:"/address",query:{cartItemIds:JSON.stringify(a.cartItemIds),from:"create-order"}})},w=()=>{u("cartItemIds","")},C=async()=>{const t={addressId:a.address.addressId,cartItemIds:a.cartList.map(d=>d.cartItemId)},{data:e}=await J(t);u("cartItemIds",""),a.orderNo=e,a.showPay=!0},N=()=>{l.push({path:"/order"})},f=async t=>{await R({orderNo:a.orderNo,payType:t}),A("支付成功"),setTimeout(()=>{l.push({path:"/order"})},2e3)},k=j(()=>{let t=0;return a.cartList.forEach(e=>{t+=e.goodsCount*e.sellingPrice}),t});return(t,e)=>{const d=B,n=Q,p=T;return m(),h("div",X,[c(x,{name:"生成订单",onCallback:w}),s("div",Y,[s("div",{class:"name",onClick:v},[s("span",null,o(a.address.userName),1),s("span",null,o(a.address.userPhone),1)]),s("div",Z,o(a.address.provinceName)+" "+o(a.address.cityName)+" "+o(a.address.regionName)+" "+o(a.address.detailAddress),1),c(d,{class:"arrow",name:"arrow"})]),s("div",ss,[(m(!0),h(H,null,M(a.cartList,(r,b)=>(m(),h("div",{class:"good-item",key:b},[s("div",as,[s("img",{src:t.$filters.prefix(r.goodsCoverImg),alt:""},null,8,es)]),s("div",ts,[s("div",os,[s("span",null,o(r.goodsName),1),s("span",null,"x"+o(r.goodsCount),1)]),s("div",rs,[s("div",ds,"¥"+o(r.sellingPrice),1)])])]))),128))]),s("div",cs,[s("div",ns,[is,s("span",null,"¥"+o(z(k)),1)]),c(n,{onClick:C,class:"pay-btn",color:"#1baeae",type:"primary",block:""},{default:_(()=>[I("生成订单")]),_:1})]),c(p,{closeable:"","close-on-click-overlay":!1,show:a.showPay,"onUpdate:show":e[2]||(e[2]=r=>a.showPay=r),position:"bottom",style:{height:"30%"},onClose:N},{default:_(()=>[s("div",ls,[c(n,{style:{marginBottom:"10px"},color:"#1989fa",block:"",onClick:e[0]||(e[0]=r=>f(1))},{default:_(()=>[I("支付宝支付")]),_:1}),c(n,{color:"#4fc08d",block:"",onClick:e[1]||(e[1]=r=>f(2))},{default:_(()=>[I("微信支付")]),_:1})])]),_:1},8,["show"])])}}},ys=V(ps,[["__scopeId","data-v-4f75e7fd"]]);export{ys as default};
