import{k as Ne,e as W,H as de,L as ye,l as He,v as ee,P as pe,s as Le}from"./index-cb802f07.js";import{c as _,Z as Ue,W as E,an as ce,d as $,Y as N,aI as q,aJ as j,G as D,T as O,ao as Te,a4 as je,ab as Se,a as u,aa as we,K as M,ag as H,ah as ke,aK as Ke,ar as K,t as ie,b as Ye,aL as ze,aM as te,Q as ue,m as xe,w as X,aN as Ge,a7 as ae,X as qe,F as Je,aO as Qe,r as We,as as Xe,ad as ne}from"./_plugin-vue_export-helper-cae794e0.js";import{a as Ze,T as et}from"./index-7c6e04a7.js";import{C as Oe}from"./index-6b0f6e36.js";import{F as tt}from"./index-94405da2.js";import{F as J}from"./index-f1cdf990.js";import{B as me}from"./index-968a7cf8.js";const[at,P,fe]=_("picker"),De=e=>e.find(a=>!a.disabled)||e[0];function nt(e,a){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(a.children in t)return"cascade"}return"default"}function Q(e,a){a=ce(a,0,e.length);for(let t=a;t<e.length;t++)if(!e[t].disabled)return t;for(let t=a-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const ve=(e,a,t)=>a!==void 0&&!!e.find(s=>s[t.value]===a);function re(e,a,t){const s=e.findIndex(g=>g[t.value]===a),o=Q(e,s);return e[o]}function lt(e,a,t){const s=[];let o={[a.children]:e},g=0;for(;o&&o[a.children];){const d=o[a.children],C=t.value[g];if(o=Ue(C)?re(d,C,a):void 0,!o&&d.length){const f=De(d)[a.value];o=re(d,f,a)}g++,s.push(d)}return s}function ot(e){const{transform:a}=window.getComputedStyle(e),t=a.slice(7,a.length-1).split(", ")[5];return Number(t)}function st(e){return E({text:"text",value:"value",children:"children"},e)}const he=200,ge=300,ct=15,[Be,le]=_("picker-column"),Ve=Symbol(Be);var it=$({name:Be,props:{value:N,fields:q(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:q(Number),swipeDuration:q(N),visibleOptionNum:q(N)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:t}){let s,o,g,d,C;const f=D(),l=D(),i=D(0),T=D(0),b=Ne(),y=()=>e.options.length,B=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=h=>{let n=Q(e.options,h);const c=-n*e.optionHeight,m=()=>{n>y()-1&&(n=Q(e.options,h));const I=e.options[n][e.fields.value];I!==e.value&&a("change",I)};s&&c!==i.value?C=m:m(),i.value=c},V=()=>e.readonly||!e.options.length,Y=h=>{s||V()||(C=null,T.value=he,k(h),a("clickOption",e.options[h]))},A=h=>ce(Math.round(-h/e.optionHeight),0,y()-1),p=O(()=>A(i.value)),z=(h,n)=>{const c=Math.abs(h/n);h=i.value+c/.003*(h<0?-1:1);const m=A(h);T.value=+e.swipeDuration,k(m)},F=()=>{s=!1,T.value=0,C&&(C(),C=null)},r=h=>{if(!V()){if(b.start(h),s){const n=ot(l.value);i.value=Math.min(0,n-B())}T.value=0,o=i.value,g=Date.now(),d=o,C=null}},S=h=>{if(V())return;b.move(h),b.isVertical()&&(s=!0,we(h,!0));const n=ce(o+b.deltaY.value,-(y()*e.optionHeight),e.optionHeight),c=A(n);c!==p.value&&a("scrollInto",e.options[c]),i.value=n;const m=Date.now();m-g>ge&&(g=m,d=n)},v=()=>{if(V())return;const h=i.value-d,n=Date.now()-g;if(n<ge&&Math.abs(h)>ct){z(h,n);return}const m=A(i.value);T.value=he,k(m),setTimeout(()=>{s=!1},0)},x=()=>{const h={height:`${e.optionHeight}px`};return e.options.map((n,c)=>{const m=n[e.fields.text],{disabled:I}=n,G=n[e.fields.value],$e={role:"button",style:h,tabindex:I?-1:0,class:[le("item",{disabled:I,selected:G===e.value}),n.className],onClick:()=>Y(c)},Fe={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:m};return u("li",$e,[t.option?t.option(n,c):u("div",Fe,null)])})};return Te(Ve),W({stopMomentum:F}),je(()=>{const h=s?Math.floor(-i.value/e.optionHeight):e.options.findIndex(m=>m[e.fields.value]===e.value),n=Q(e.options,h),c=-n*e.optionHeight;s&&n<h&&F(),i.value=c}),Se("touchmove",S,{target:f}),()=>u("div",{ref:f,class:le(),onTouchstartPassive:r,onTouchend:v,onTouchcancel:v},[u("ul",{ref:l,style:{transform:`translate3d(0, ${i.value+B()}px, 0)`,transitionDuration:`${T.value}ms`,transitionProperty:T.value?"all":"none"},class:le("wrapper"),onTransitionend:F},[x()])])}});const[ut]=_("picker-toolbar"),Z={title:String,cancelButtonText:String,confirmButtonText:String},Pe=["cancel","confirm","title","toolbar"],rt=Object.keys(Z);var Ee=$({name:ut,props:Z,emits:["confirm","cancel"],setup(e,{emit:a,slots:t}){const s=()=>{if(t.title)return t.title();if(e.title)return u("div",{class:[P("title"),"van-ellipsis"]},[e.title])},o=()=>a("cancel"),g=()=>a("confirm"),d=()=>{var f;const l=(f=e.cancelButtonText)!=null?f:fe("cancel");if(!(!t.cancel&&!l))return u("button",{type:"button",class:[P("cancel"),de],onClick:o},[t.cancel?t.cancel():l])},C=()=>{var f;const l=(f=e.confirmButtonText)!=null?f:fe("confirm");if(!(!t.confirm&&!l))return u("button",{type:"button",class:[P("confirm"),de],onClick:g},[t.confirm?t.confirm():l])};return()=>u("div",{class:P("toolbar")},[t.toolbar?t.toolbar():[d(),s(),C()]])}});const dt=(e,a)=>{const t=D(e());return M(e,s=>{s!==t.value&&(t.value=s)}),M(t,s=>{s!==e()&&a(s)}),t},[_e,oe]=_("picker-group"),Ae=Symbol(_e),mt=E({tabs:j(),activeTab:H(0),nextStepText:String},Z);$({name:_e,props:mt,emits:["confirm","cancel","update:activeTab"],setup(e,{emit:a,slots:t}){const s=dt(()=>e.activeTab,l=>a("update:activeTab",l)),{children:o,linkChildren:g}=ke(Ae);g();const d=()=>+s.value<e.tabs.length-1&&e.nextStepText,C=()=>{d()?s.value=+s.value+1:a("confirm",o.map(l=>l.confirm()))},f=()=>a("cancel");return()=>{var l,i;const T=(i=(l=t.default)==null?void 0:l.call(t))==null?void 0:i.filter(y=>y.type!==Ke),b=d()?e.nextStepText:e.confirmButtonText;return u("div",{class:oe()},[u(Ee,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:b,onConfirm:C,onCancel:f},K(t,Pe)),u(Ze,{active:s.value,"onUpdate:active":y=>s.value=y,class:oe("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((y,B)=>u(et,{title:y,titleClass:oe("tab-title")},{default:()=>[T==null?void 0:T[B]]}))]})])}}});const Ie=E({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:H(44),showToolbar:ie,swipeDuration:H(1e3),visibleOptionNum:H(6)},Z),ft=E({},Ie,{columns:j(),modelValue:j(),toolbarPosition:Ye("top"),columnsFieldNames:Object});var vt=$({name:at,props:ft,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:t}){const s=D(),o=D(e.modelValue.slice(0)),{parent:g}=Te(Ae),{children:d,linkChildren:C}=ke(Ve);C();const f=O(()=>st(e.columnsFieldNames)),l=O(()=>ze(e.optionHeight)),i=O(()=>nt(e.columns,f.value)),T=O(()=>{const{columns:n}=e;switch(i.value){case"multiple":return n;case"cascade":return lt(n,f.value,o);default:return[n]}}),b=O(()=>T.value.some(n=>n.length)),y=O(()=>T.value.map((n,c)=>re(n,o.value[c],f.value))),B=O(()=>T.value.map((n,c)=>n.findIndex(m=>m[f.value.value]===o.value[c]))),k=(n,c)=>{if(o.value[n]!==c){const m=o.value.slice(0);m[n]=c,o.value=m}},V=()=>({selectedValues:o.value.slice(0),selectedOptions:y.value,selectedIndexes:B.value}),Y=(n,c)=>{k(c,n),i.value==="cascade"&&o.value.forEach((m,I)=>{const G=T.value[I];ve(G,m,f.value)||k(I,G.length?G[0][f.value.value]:void 0)}),ue(()=>{a("change",E({columnIndex:c},V()))})},A=(n,c)=>{const m={columnIndex:c,currentOption:n};a("clickOption",E(V(),m)),a("scrollInto",m)},p=()=>{d.forEach(c=>c.stopMomentum());const n=V();return ue(()=>{a("confirm",n)}),n},z=()=>a("cancel",V()),F=()=>T.value.map((n,c)=>u(it,{value:o.value[c],fields:f.value,options:n,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:l.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:m=>Y(m,c),onClickOption:m=>A(m,c),onScrollInto:m=>{a("scrollInto",{currentOption:m,columnIndex:c})}},{option:t.option})),r=n=>{if(b.value){const c={height:`${l.value}px`},m={backgroundSize:`100% ${(n-l.value)/2}px`};return[u("div",{class:P("mask"),style:m},null),u("div",{class:[He,P("frame")],style:c},null)]}},S=()=>{const n=l.value*+e.visibleOptionNum,c={height:`${n}px`};return u("div",{ref:s,class:P("columns"),style:c},[F(),r(n)])},v=()=>{if(e.showToolbar&&!g)return u(Ee,xe(K(e,rt),{onConfirm:p,onCancel:z}),K(t,Pe))};M(T,n=>{n.forEach((c,m)=>{c.length&&!ve(c,o.value[m],f.value)&&k(m,De(c)[f.value.value])})},{immediate:!0});let x;return M(()=>e.modelValue,n=>{!te(n,o.value)&&!te(n,x)&&(o.value=n.slice(0),x=n.slice(0))},{deep:!0}),M(o,n=>{te(n,e.modelValue)||(x=n.slice(0),a("update:modelValue",x))},{immediate:!0}),Se("touchmove",we,{target:s}),W({confirm:p,getSelectedOptions:()=>y.value}),()=>{var n,c;return u("div",{class:P()},[e.toolbarPosition==="top"?v():null,e.loading?u(ye,{class:P("loading")},null):null,(n=t["columns-top"])==null?void 0:n.call(t),S(),(c=t["columns-bottom"])==null?void 0:c.call(t),e.toolbarPosition==="bottom"?v():null])}}});const U="000000",ht=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],Re=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],R=(e="",a=U,t=void 0)=>({text:e,value:a,children:t});function gt({areaList:e,columnsNum:a,columnsPlaceholder:t}){const{city_list:s={},county_list:o={},province_list:g={}}=e,d=+a>1,C=+a>2,f=()=>{if(d)return t.length?[R(t[0],U,C?[]:void 0)]:[]},l=new Map;Object.keys(g).forEach(b=>{l.set(b.slice(0,2),R(g[b],b,f()))});const i=new Map;if(d){const b=()=>{if(C)return t.length?[R(t[1])]:[]};Object.keys(s).forEach(y=>{const B=R(s[y],y,b());i.set(y.slice(0,4),B);const k=l.get(y.slice(0,2));k&&k.children.push(B)})}C&&Object.keys(o).forEach(b=>{const y=i.get(b.slice(0,4));y&&y.children.push(R(o[b],b))});const T=Array.from(l.values());if(t.length){const b=C?[R(t[2])]:void 0,y=d?[R(t[1],U,b)]:void 0;T.unshift(R(t[0],U,y))}return T}const bt=X(vt),[Ct,yt]=_("area"),Tt=E({},K(Ie,Re),{modelValue:String,columnsNum:H(3),columnsPlaceholder:j(),areaList:{type:Object,default:()=>({})}});var St=$({name:Ct,props:Tt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:a,slots:t}){const s=D([]),o=D(),g=O(()=>gt(e)),d=(...l)=>a("change",...l),C=(...l)=>a("cancel",...l),f=(...l)=>a("confirm",...l);return M(s,l=>{const i=l.length?l[l.length-1]:"";i&&i!==e.modelValue&&a("update:modelValue",i)},{deep:!0}),M(()=>e.modelValue,l=>{if(l){const i=s.value.length?s.value[s.value.length-1]:"";l!==i&&(s.value=[`${l.slice(0,2)}0000`,`${l.slice(0,4)}00`,l].slice(0,+e.columnsNum))}else s.value=[]},{immediate:!0}),W({confirm:()=>{var l;return(l=o.value)==null?void 0:l.confirm()},getSelectedOptions:()=>{var l;return((l=o.value)==null?void 0:l.getSelectedOptions())||[]}}),()=>u(bt,xe({ref:o,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,class:yt(),columns:g.value,onChange:d,onCancel:C,onConfirm:f},K(e,Re)),K(t,ht))}});const wt=X(St),[kt,se]=_("switch"),xt={size:N,loading:Boolean,disabled:Boolean,modelValue:ae,activeColor:String,inactiveColor:String,activeValue:{type:ae,default:!0},inactiveValue:{type:ae,default:!1}};var Ot=$({name:kt,props:xt,emits:["change","update:modelValue"],setup(e,{emit:a,slots:t}){const s=()=>e.modelValue===e.activeValue,o=()=>{if(!e.disabled&&!e.loading){const d=s()?e.inactiveValue:e.activeValue;a("update:modelValue",d),a("change",d)}},g=()=>{if(e.loading){const d=s()?e.activeColor:e.inactiveColor;return u(ye,{class:se("loading"),color:d},null)}if(t.node)return t.node()};return Ge(()=>e.modelValue),()=>{var d;const{size:C,loading:f,disabled:l,activeColor:i,inactiveColor:T}=e,b=s(),y={fontSize:qe(C),backgroundColor:b?i:T};return u("div",{role:"switch",class:se({on:b,loading:f,disabled:l}),style:y,tabindex:l?void 0:0,"aria-checked":b,onClick:o},[u("div",{class:se("node")},[g()]),(d=t.background)==null?void 0:d.call(t)])}}});const Dt=X(Ot),[Bt,be]=_("address-edit-detail"),Ce=_("address-edit")[2];var Vt=$({name:Bt,props:{show:Boolean,rows:N,value:String,rules:Array,focused:Boolean,maxlength:N,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:a}){const t=D(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,o=l=>{a("selectSearch",l),a("input",`${l.address||""} ${l.name||""}`.trim())},g=()=>{if(!s())return;const{searchResult:l}=e;return l.map(i=>u(Oe,{clickable:!0,key:(i.name||"")+(i.address||""),icon:"location-o",title:i.name,label:i.address,class:be("search-item"),border:!1,onClick:()=>o(i)},null))},d=l=>a("blur",l),C=l=>a("focus",l),f=l=>a("input",l);return()=>{if(e.show)return u(Je,null,[u(J,{autosize:!0,clearable:!0,ref:t,class:be(),rows:e.rows,type:"textarea",rules:e.rules,label:Ce("addressDetail"),border:!s(),maxlength:e.maxlength,modelValue:e.value,placeholder:Ce("addressDetail"),onBlur:d,onFocus:C,"onUpdate:modelValue":f},null),g()])}}});const[Pt,L,w]=_("address-edit"),Me={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Et={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:ie,showDetail:ie,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:N,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:H(1),detailMaxlength:H(200),areaColumnsPlaceholder:j(),addressInfo:{type:Object,default:()=>E({},Me)},telValidator:{type:Function,default:Qe}};var _t=$({name:Pt,props:Et,emits:["save","focus","change","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:a,slots:t}){const s=D(),o=We({}),g=D(!1),d=D(!1),C=O(()=>Xe(e.areaList)&&Object.keys(e.areaList).length),f=O(()=>{const{province:r,city:S,county:v,areaCode:x}=o;if(x){const h=[r,S,v];return r&&r===S&&h.splice(1,1),h.filter(Boolean).join("/")}return""}),l=O(()=>{var r;return((r=e.searchResult)==null?void 0:r.length)&&d.value}),i=r=>{d.value=r==="addressDetail",a("focus",r)},T=(r,S)=>{a("change",{key:r,value:S})},b=O(()=>{const{validator:r,telValidator:S}=e,v=(x,h)=>({validator:n=>{if(r){const c=r(x,n);if(c)return c}return n?!0:h}});return{name:[v("name",w("nameEmpty"))],tel:[v("tel",w("telInvalid")),{validator:S,message:w("telInvalid")}],areaCode:[v("areaCode",w("areaEmpty"))],addressDetail:[v("addressDetail",w("addressEmpty"))]}}),y=()=>a("save",o),B=r=>{o.addressDetail=r,a("changeDetail",r)},k=r=>{o.province=r[0].text,o.city=r[1].text,o.county=r[2].text},V=({selectedValues:r,selectedOptions:S})=>{r.some(v=>v===U)?Le(w("areaEmpty")):(g.value=!1,k(S),a("changeArea",S))},Y=()=>a("delete",o),A=r=>{o.areaCode=r||""},p=()=>{setTimeout(()=>{d.value=!1})},z=r=>{o.addressDetail=r},F=()=>{if(e.showSetDefault){const r={"right-icon":()=>u(Dt,{modelValue:o.isDefault,"onUpdate:modelValue":S=>o.isDefault=S,onChange:S=>a("changeDefault",S)},null)};return ne(u(Oe,{center:!0,border:!1,title:w("defaultAddress"),class:L("default")},r),[[ee,!l.value]])}};return W({setAreaCode:A,setAddressDetail:z}),M(()=>e.addressInfo,r=>{E(o,Me,r),ue(()=>{var S;const v=(S=s.value)==null?void 0:S.getSelectedOptions();v&&v.every(x=>x&&x.value!==U)&&k(v)})},{deep:!0,immediate:!0}),()=>{const{disableArea:r}=e;return u(tt,{class:L(),onSubmit:y},{default:()=>{var S;return[u("div",{class:L("fields")},[u(J,{modelValue:o.name,"onUpdate:modelValue":[v=>o.name=v,v=>T("name",v)],clearable:!0,label:w("name"),rules:b.value.name,placeholder:w("name"),onFocus:()=>i("name")},null),u(J,{modelValue:o.tel,"onUpdate:modelValue":[v=>o.tel=v,v=>T("tel",v)],clearable:!0,type:"tel",label:w("tel"),rules:b.value.tel,maxlength:e.telMaxlength,placeholder:w("tel"),onFocus:()=>i("tel")},null),ne(u(J,{readonly:!0,label:w("area"),"is-link":!r,modelValue:f.value,rules:e.showArea?b.value.areaCode:void 0,placeholder:e.areaPlaceholder||w("area"),onFocus:()=>i("areaCode"),onClick:()=>{a("clickArea"),g.value=!r}},null),[[ee,e.showArea]]),u(Vt,{show:e.showDetail,rows:e.detailRows,rules:b.value.addressDetail,value:o.addressDetail,focused:d.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:p,onFocus:()=>i("addressDetail"),onInput:B,onSelectSearch:v=>a("selectSearch",v)},null),(S=t.default)==null?void 0:S.call(t)]),F(),ne(u("div",{class:L("buttons")},[u(me,{block:!0,round:!0,type:"primary",text:e.saveButtonText||w("save"),class:L("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&u(me,{block:!0,round:!0,class:L("button"),loading:e.isDeleting,text:e.deleteButtonText||w("delete"),onClick:Y},null)]),[[ee,!l.value]]),u(pe,{show:g.value,"onUpdate:show":v=>g.value=v,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[u(wt,{modelValue:o.areaCode,"onUpdate:modelValue":v=>o.areaCode=v,ref:s,loading:!C.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:V,onCancel:()=>{g.value=!1}},null)]})]}})}}});const Ht=X(_t);export{Ht as A};
