import{s as L}from"./SimpleHeader-d42a7f83.js";import{g as x,c as A,E as D,D as E}from"./address-4a88397d.js";import{V as o,s as _}from"./index-cb802f07.js";import{ay as b,u as w,r as k,ae as R,o as T,e as j,a as y}from"./_plugin-vue_export-helper-cae794e0.js";import{A as B}from"./index-326d6132.js";import"./index-7c6e04a7.js";import"./use-id-cc124f28.js";import"./use-route-7443569a.js";import"./index-6b0f6e36.js";import"./index-94405da2.js";import"./index-f1cdf990.js";import"./index-968a7cf8.js";const C={class:"address-edit-box"},U={__name:"AddressEdit",setup(F){const l=b(),m=w(),e=k({areaList:{province_list:{},city_list:{},county_list:{}},searchResult:[],type:"add",addressId:"",addressInfo:{},from:l.query.from});R(async()=>{let t={},a={},i={};o.getLev1().forEach(s=>{t[s.id]=s.text,o.getLev2(s.id).forEach(r=>{a[r.id]=r.text,o.getLev3(r.id).forEach(d=>i[d.id]=d.text)})}),e.areaList.province_list=t,e.areaList.city_list=a,e.areaList.county_list=i;const{addressId:u,type:p,from:h}=l.query;if(e.addressId=u,e.type=p,e.from=h||"",p=="edit"){const{data:s}=await x(u);let r="";const d=o.getLev1();Object.entries(e.areaList.county_list).forEach(([c,I])=>{if(I==s.regionName){const N=d.findIndex(n=>n.id.substr(0,2)==c.substr(0,2)),g=Object.entries(e.areaList.city_list).filter(([n,O])=>n.substr(0,4)==c.substr(0,4))[0];d[N].text==s.provinceName&&g[1]==s.cityName&&(r=c)}}),e.addressInfo={id:s.addressId,name:s.userName,tel:s.userPhone,province:s.provinceName,city:s.cityName,county:s.regionName,addressDetail:s.detailAddress,areaCode:r,isDefault:!!s.defaultFlag}}});const f=async t=>{const a={userName:t.name,userPhone:t.tel,provinceName:t.province,cityName:t.city,regionName:t.county,detailAddress:t.addressDetail,defaultFlag:t.isDefault?1:0};e.type=="edit"&&(a.addressId=e.addressId),await e.type=="add"?A(a):D(a),_("保存成功"),setTimeout(()=>{m.back()},1e3)},v=async()=>{await E(e.addressId),_("删除成功"),setTimeout(()=>{m.back()},1e3)};return(t,a)=>{const i=B;return T(),j("div",C,[y(L,{name:`${e.type=="add"?"新增地址":"编辑地址"}`},null,8,["name"]),y(i,{class:"edit","area-list":e.areaList,"address-info":e.addressInfo,"show-delete":e.type=="edit","show-set-default":"","show-search-result":"","search-result":e.searchResult,"area-columns-placeholder":["请选择","请选择","请选择"],onSave:f,onDelete:v},null,8,["area-list","address-info","show-delete","search-result"])])}}};export{U as default};
